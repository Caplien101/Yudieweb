<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ceklist Kebersihan</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-wrap: wrap;
      gap: 20px; /* Jarak antar kartu */
      padding: 20px;
      background-color: #f0f2f5;
      margin: 0;
    }
    h1 {
      width: 100%;
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .card {
      background-color: #ffffff;
      border-radius: 8px; /* Radius border lebih kecil */
      padding: 15px; /* Padding kartu lebih kecil */
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 300px; /* Lebar maksimum kartu lebih kecil */
      box-sizing: border-box;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .card-content {
      margin-bottom: 15px;
    }
    .card-content span {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #333;
    }
    .card-content select,
    .card-content input {
      width: calc(100% - 20px);
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .update-button {
      background-color: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px; /* Radius border tombol lebih kecil */
      padding: 8px; /* Padding tombol lebih kecil */
      cursor: pointer;
      text-align: center;
      width: 100%;
      font-size: 14px; /* Ukuran font tombol lebih kecil */
      transition: background-color 0.3s ease, opacity 0.3s ease;
      position: relative;
    }
    .update-button.loading {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    .update-button.loading::after {
      content: 'Sedang mengirim data...';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 12px;
    }
    .update-button:hover {
      background-color: #218838;
    }
    .card-content input[disabled],
    .card-content select[disabled] {
      background-color: #e9ecef;
    }
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #28a745;
      color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      display: none;
    }
    .alert.error {
      background-color: #dc3545;
    }
  </style>
</head>
<body>
  <div class="alert" id="alert"></div>
  <h1>API Tester with Card View</h1>
  <div id="card-container"></div>

  <script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxEleM1JCpR4QAqdcjmbHARqMuJ_RErTLXcLooA7Qa3R25eM-uHypTlp4BmJ5RmPR9e/exec'; // Ganti dengan URL web app Anda

    function showAlert(message, isError = false) {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = isError ? 'alert error' : 'alert';
      alert.style.display = 'block';
      setTimeout(() => alert.style.display = 'none', 3000); // Hide alert after 3 seconds
    }

    function fetchData() {
      fetch(`${webAppUrl}?action=getData`)
        .then(response => response.json())
        .then(data => {
          displayData(data);
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Error fetching data', true);
        });
    }

    function displayData(data) {
      const container = document.getElementById('card-container');
      container.innerHTML = '';

      if (data.length > 0) {
        for (let i = 1; i < data.length; i++) {
          const card = document.createElement('div');
          card.className = 'card';
          card.setAttribute('data-row', i);

          const statusOptions = `
            <option value="Belum dikerjakan" ${data[i][3] === 'Belum dikerjakan' ? 'selected' : ''}>Belum dikerjakan</option>
            <option value="Sudah dikerjakan" ${data[i][3] === 'Sudah dikerjakan' ? 'selected' : ''}>Sudah dikerjakan</option>
          `;
          
          const formattedDate = formatDate(data[i][4]);

          let cardContent = '<div class="card-content">';
          
          // Menyesuaikan dengan kolom Id, Nama, Rak, Status, Tanggal
          cardContent += `
            <span>Id</span>
            <input type="text" value="${data[i][0]}" data-col="0" disabled />
            <span>Nama</span>
            <input type="text" value="${data[i][1]}" data-col="1" disabled />
            <span>Rak</span>
            <input type="text" value="${data[i][2]}" data-col="2" disabled />
            <span>Status</span>
            <select data-col="3">
              ${statusOptions}
            </select>
            <span>Tanggal</span>
            <input type="text" value="${formattedDate}" data-col="4" disabled />
            <button class="update-button" onclick="updateCard(${i}, this)">Update Data</button>
          </div>`;
          
          card.innerHTML = cardContent;
          container.appendChild(card);
        }
      }
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function updateCard(row, button) {
      button.classList.add('loading');
      button.textContent = '';

      const card = document.querySelector(`[data-row="${row}"]`);
      const statusSelect = card.querySelector('select[data-col="3"]');
      const status = statusSelect.value;
      const currentDate = new Date();
      const formattedDate = formatDateForUpdate(currentDate);

      const updateRequests = [
        fetch(`${webAppUrl}?action=updateData&row=${row}&col=3&value=${encodeURIComponent(status)}`)
      ];
      
      if (status === 'Sudah dikerjakan') {
        updateRequests.push(
          fetch(`${webAppUrl}?action=updateData&row=${row}&col=4&value=${encodeURIComponent(formattedDate)}`)
        );
      }
      
      Promise.all(updateRequests)
        .then(responses => Promise.all(responses.map(response => response.text())))
        .then(results => {
          if (results.every(result => result === 'Update Successful')) {
            showAlert('Data updated successfully');
            fetchData(); // Refresh data after update
          } else {
            showAlert('Update Error', true);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Error updating data', true);
        })
        .finally(() => {
          button.classList.remove('loading');
          button.textContent = 'Update Data';
        });
    }

    function formatDateForUpdate(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    window.onload = fetchData;
  </script>
</body>
</html>
