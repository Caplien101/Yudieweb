<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ceklist Kebersihan</title>
  <style>
    /* Style your page here */
    body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display: flex;
  flex-direction: column;
  padding: 20px;
  background-color: #f0f2f5;
  margin: 0;
}
h1 {
  width: 100%;
  text-align: center;
  color: #333;
  margin-bottom: 20px;
}
.search-container {
  margin-bottom: 20px;
  text-align: center;
}
.search-bar {
  width: 100%;
  max-width: 600px;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-sizing: border-box;
  font-size: 16px;
}
.card-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px; /* Jarak antar kartu */
  justify-content: center; /* Center align cards */
}
.card {
  background-color: #ffffff;
  border-radius: 8px; /* Radius border lebih kecil */
  padding: 15px; /* Padding kartu lebih kecil */
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 320px; /* Lebar maksimum kartu lebih besar */
  box-sizing: border-box;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}
.card-content {
  margin-bottom: 15px;
}
.card-content span {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #333;
}
.card-content select,
.card-content input {
  width: calc(100% - 20px);
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-sizing: border-box;
  margin-bottom: 10px;
  font-size: 14px;
}
.update-button {
  background-color: #28a745;
  color: #fff;
  border: none;
  border-radius: 4px; /* Radius border tombol lebih kecil */
  padding: 10px; /* Padding tombol lebih besar */
  cursor: pointer;
  text-align: center;
  width: 100%;
  font-size: 16px; /* Ukuran font tombol lebih kecil */
  transition: background-color 0.3s ease, opacity 0.3s ease;
  position: relative;
  overflow: hidden; /* Ensure the loading text doesn't overflow */
}
.update-button.loading {
  background-color: #6c757d;
  cursor: not-allowed;
}
.update-button.loading::after {
  content: 'Sedang mengirim data...';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  color: #fff;
  font-size: 12px;
  white-space: nowrap; /* Prevents the text from breaking into multiple lines */
}
.update-button:hover {
  background-color: #218838;
}
.card-content input[disabled],
.card-content select[disabled] {
  background-color: #e9ecef;
}
.alert {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #28a745;
  color: white;
  padding: 15px;
  border-radius: 5px;
  box-shadow: 0 6px 12px rgba(0,0,0,0.1);
  display: none;
  z-index: 1000; /* Ensure it's on top of other content */
}
.alert.error {
  background-color: #dc3545;
}
.home-button {
  position: absolute;
  top: 20px;
  right: 20px;
  background-color: #ffc107;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 10px;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transition: background-color 0.3s ease;
}
.home-button:hover {
  background-color: #e0a800;
}
@media (max-width: 600px) {
  .card-container {
    flex-direction: column; /* Stack cards vertically */
    align-items: center; /* Center align cards horizontally */
  }
  .card {
    max-width: 90%; /* Make card 90% width of the screen on small screens */
    width: 100%; /* Ensure card takes full width of the 90% */
  }
  .search-bar {
    width: 100%; /* Make search bar full width on small screens */
  }
}

  </style>
</head>
<body>
  <button class="home-button" onclick="window.location.href='index.html';">
    <i class="fas fa-home"></i>
  </button>
  <div class="alert" id="alert"></div>
  <h1>Ceklist Kebersihan</h1>
  <div class="search-container">
    <input type="text" id="search-bar" class="search-bar" placeholder="Cari berdasarkan nama..." oninput="searchData()">
  </div>
  <div id="card-container" class="card-container"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  <script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxEleM1JCpR4QAqdcjmbHARqMuJ_RErTLXcLooA7Qa3R25eM-uHypTlp4BmJ5RmPR9e/exec'; // Ganti dengan URL web app Anda

    let allData = [];

    function showAlert(message, isError = false) {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = isError ? 'alert error' : 'alert';
      alert.style.display = 'block';
      setTimeout(() => alert.style.display = 'none', 3000); // Hide alert after 3 seconds
    }

    function fetchData() {
      fetch(`${webAppUrl}?action=getData`)
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            // Skip the first row which is assumed to be the header
            allData = data.slice(1);
            displayData(allData);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Error fetching data', true);
        });
    }

    function displayData(data) {
      const container = document.getElementById('card-container');
      container.innerHTML = '';

      if (data.length > 0) {
        for (let i = 0; i < data.length; i++) { // Perhatikan index dimulai dari 0
          const card = document.createElement('div');
          card.className = 'card';
          card.setAttribute('data-original-row', data[i][0]); // Simpan ID baris asli

          const statusOptions = `
            <option value="Belum dikerjakan" ${data[i][3] === 'Belum dikerjakan' ? 'selected' : ''}>Belum dikerjakan</option>
            <option value="Sudah dikerjakan" ${data[i][3] === 'Sudah dikerjakan' ? 'selected' : ''}>Sudah dikerjakan</option>
          `;
          
          const formattedDate = formatDate(data[i][4]);

          let cardContent = '<div class="card-content">';
          
          // Menyesuaikan dengan kolom Id, Nama, Rak, Status, Tanggal
          cardContent += `
            <span>Id</span>
            <input type="text" value="${data[i][0]}" data-col="0" disabled />
            <span>Nama</span>
            <input type="text" value="${data[i][1]}" data-col="1" disabled />
            <span>Rak</span>
            <input type="text" value="${data[i][2]}" data-col="2" disabled />
            <span>Status</span>
            <select data-col="3">
              ${statusOptions}
            </select>
            <span>Tanggal</span>
            <input type="text" value="${formattedDate}" data-col="4" disabled />
            <button class="update-button" onclick="updateCard('${data[i][0]}', this)">Update Data</button>
          </div>`;
          
          card.innerHTML = cardContent;
          container.appendChild(card);
        }
      }
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function updateCard(originalRowId, button) {
      button.classList.add('loading');
      button.textContent = ''; // Hide the original button text

      const card = document.querySelector(`[data-original-row="${originalRowId}"]`);
      const statusSelect = card.querySelector('select[data-col="3"]');
      const status = statusSelect.value;
      const currentDate = new Date();
      const formattedDate = formatDateForUpdate(currentDate);

      const updateRequests = [
        fetch(`${webAppUrl}?action=updateData&row=${originalRowId}&col=3&value=${encodeURIComponent(status)}`)
      ];
      
      if (status === 'Sudah dikerjakan') {
        updateRequests.push(
          fetch(`${webAppUrl}?action=updateData&row=${originalRowId}&col=4&value=${encodeURIComponent(formattedDate)}`)
        );
      }
      
      Promise.all(updateRequests)
        .then(responses => Promise.all(responses.map(response => response.text())))
        .then(results => {
          if (results.every(result => result === 'Update Successful')) {
            showAlert('Data updated successfully');
            fetchData(); // Refresh data after update
          } else {
            showAlert('Update Error', true);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Error updating data', true);
        })
        .finally(() => {
          button.classList.remove('loading');
          button.textContent = 'Update Data';
        });
    }

    function formatDateForUpdate(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function searchData() {
      const searchQuery = document.getElementById('search-bar').value.toLowerCase();
      const filteredData = allData.filter(row => row[1].toLowerCase().includes(searchQuery));
      displayData(filteredData);
    }

    window.onload = fetchData;
  </script>
</body>
</html>
