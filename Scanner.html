<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Scanner</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-3">

    <div class="container">
        <h3 class="text-center">Barcode Scanner</h3>

        <!-- Button untuk Mulai Scan -->
        <div class="text-center mt-3">
            <button id="startScanner" class="btn btn-primary">Mulai Scan</button>
        </div>

        <!-- Area Kamera -->
        <div class="text-center mt-3">
            <div id="reader" style="width: 100%; max-width: 400px; margin: auto; display: none;"></div>
        </div>

        <!-- Hasil Scan dalam bentuk Card -->
        <div id="scanResults" class="mt-4">
            <h5>Hasil Scan:</h5>
            <div id="resultContainer" class="row row-cols-1 row-cols-md-2 g-2"></div>
        </div>
    </div>

    <script>
        let scanner;
        const startScannerBtn = document.getElementById("startScanner");
        const readerElement = document.getElementById("reader");
        const resultContainer = document.getElementById("resultContainer");

        function startScanner() {
            if (!scanner) {
                scanner = new Html5Qrcode("reader");
            }

            readerElement.style.display = "block";
            startScannerBtn.disabled = true; // Disable button agar tidak double scan

            scanner.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                (decodedText) => {
                    addBarcodeToCard(decodedText);
                    stopScanner(); // Tutup kamera setelah scan sukses
                },
                (errorMessage) => {
                    console.warn(errorMessage);
                }
            ).catch(err => console.error(err));
        }

        function stopScanner() {
            if (scanner) {
                scanner.stop().then(() => {
                    readerElement.style.display = "none";
                    startScannerBtn.disabled = false; // Aktifkan kembali tombol setelah scan selesai
                });
            }
        }

        function addBarcodeToCard(barcode) {
            const card = document.createElement("div");
            card.className = "col";
            card.innerHTML = `
                <div class="card shadow-sm border-success">
                    <div class="card-body">
                        <h5 class="card-title text-success">${barcode}</h5>
                        <p class="card-text">Scanned at: ${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `;
            resultContainer.prepend(card);
        }

        startScannerBtn.addEventListener("click", startScanner);
    </script>

</body>
</html>
